\section{Linear problem}\label{linear}
We consider axisymmetric Eulerian perturbations to the above
equilibrium in the form $\real[\dd\rho(z)\exp{\imgi(k_xx + \sigma
    t)}]$ and similarly for other fluid variables. Here, $k_x$ is a
constant radial wavenumber and $\sigma=-(\omega +\imgi\gamma)$ is a
complex  frequency, where $-\omega$ is the real mode frequency and $\gamma$ is
the growth rate. We take $k_x>0$ without loss of generality. 
Hereafter, we suppress the exponential factor and the real part notation. 

The linearized continuity equation is 
\begin{align}
  \frac{\imgi\sigma}{c_s^2}W + \imgi k_x \dd v_x
  +\left(\ln\rho\right)^\prime\dd v_z + \dd v_z^\prime = 0,\label{lin_cont}
\end{align}
where $^\prime$ denotes $d/dz$ and $W=\delta P/\rho =
c_s^2\delta\rho/\rho$ is the enthalpy perturbation.  
The linearized equations of motion are
\begin{align}
  &\imgi\sigma \dvx - 2\Omega\dvy  = - \imgi
  k_x\w + \frac{B_z}{\mu_0\rho} \left[\dbx^\prime - \imgi 
    k_x\left(\dbz + \epsilon\dby\right)\right],\\
  &\imgi\sigma\dvy + 
    \frac{\kappa^2}{2\Omega}\dvx = \frac{B_z}{\mu_0\rho}\dby^\prime\label{lin_vy},\\ 
  & \imgi\sigma\dvz = -\w^\prime - \frac{B_y}{\mu_0\rho}\dby^\prime\label{lin_vz},  
\end{align}
where the effective enthalpy perturbation
$\w = W + \dphi$. The components of the linearized induction equation
are 
\begin{align}
&  \imgi\bar{\sigma}\dbx = B_z\dvx^\prime +
  \eta\dbx^{\prime\prime}+\eta^\prime\dbx^\prime - \imgi k_x
  \eta^\prime \dbz,\label{induct_x}\\
&\imgi\bar{\sigma}\dby = B_z\dvy^\prime -B_y\Delta - S\dbx +
  \eta\dby^{\prime\prime}+\eta^\prime\dby^\prime,\label{induct_y}\\
& \imgi\bar{\sigma}\dbz = -\imgi  k_xB_z \dvx +
\eta\dbz^{\prime\prime}, \label{induct_vert}
%& \imgi\bar{\sigma}\dbz = -\imgi  k_x \dvx  -\imgi k_x\eta \dbx^{\prime}, \label{induct_vert}
\end{align} 
where $\imgi\bar{\sigma} = \imgi\sigma + \eta k_x^2$,
$\Delta\equiv \nabla\cdot\bm{\delta v}  = \imgi k_x\dvx + \dvz^\prime$,   
and the divergence-free condition is $\imgi k_x\dbx +
\dbz^\prime=0$. Finally, the linearized Poisson equation is 
\begin{align}
  \dphi^{\prime\prime} - k_x^2\dphi = \frac{\Omega^2\rho}{c_s^2Q\rho_0}W.  \label{lin_poisson}
\end{align}

We eliminate $\dd\bm{B}$ and $\dvz$ between the linearized
equations to obtain a system of ordinary differential equations for
$\bm{U}=\left(\dvx,\dvy,W,\dphi\right)$. We detail the steps 
in Appendix \ref{reduction} for two cases considered in this paper:
%We consider two cases:
\begin{enumerate}
\item Purely vertical field with constant or variable
  resistivity, so that $\epsilon = 0$ and $\eta=\eta(z)$. 
\item Tilted field with uniform resistivity
  so that $\epsilon \neq 0$ and $\eta=\rm{constant}$.   
\end{enumerate}
Schematically, the numerical problem is to solve 
\begin{align}
  L_{11}\dvx + L_{12}\dvy + L_{13}W + L_{14}\dphi &= 0, \label{lin1}\\
  L_{21}\dvx + L_{22}\dvy + L_{23}W + L_{24}\dphi &= 0, \label{lin2}\\
  L_{31}\dvx +L_{32}\dvy + L_{33}W + L_{34}\dphi &=0,\label{lin3}\\
  \phantom{L_{31}\dvx + L_{22}\dvy +} L_{43}W + L_{44}\dphi
  &=0\label{lin4},
\end{align}
where the differential operators $L_{1j},\,L_{2j}$ and $L_{3j}$
($j=1,2,3,4$) can be read off Appendix \ref{reduction} and $L_{4j}$
($j=3,4$) from the linearized Poisson equation above. We remark that
the case of a tilted field and variable resistivity
%($\epsilon\neq0$ and $\eta=\eta(z)$
can also be reduced to the above form. 


%where the differential operators $L_{1j}$, $L_{2j}$ and $L_{3j}$ can
%be read off Eq. \ref{final_vx}, Eq. \ref{final_vy} and 
%Eq. \ref{final_w} respectively, and $L_{4j}$ from
%Eq. \ref{lin_poisson}. 

%Note that $L_{13},\,L_{14},\,L_{23},\,L_{24}$ and $L_{31}$ are
%proportional to $k_x$. Then for for $k_x=0$ 
%Eq. \ref{lin1}---\ref{lin2} are decoupled from 
%Eq. \ref{lin3}---\ref{lin4}. In this case, a solution is $\dphi=W=0$,
%with $\dvx$ and $\dvy$ determined by $L_{11}\dvx + L_{12}\dvy = 0$ and 
%$L_{21}\dvx + L_{22}\dvy=0$, which is the incompressible MRI problem. 
%This means that the density and potential perturbations can only
%influence the MRI for $k_x\neq0$. Nevertheless, for $k_x=0$,
%self-gravity can still have an effect through the background
%equilibrium.  


\subsection{Domain and boundary conditions}\label{domain}

\subsubsection{Case 1: vertical field}
We impose $\bm{U}$ to be an even function of $z$, so that
$d\bm{U}/dz=0$ at $z=0$. This permits higher numerical resolution by
reducing the computational domain to $z\in~[0,Z_s]$.  
At the upper disk boundary $z=Z_s$ we set 
\begin{align}
  \dbx(Z_s) = \dby(Z_s) = \dvz (Z_s) = 0, 
\end{align}
so the field remains vertical. The potential boundary
condition is 
\begin{align}
  \dphi^\prime(\zmax) + k_x\dphi(\zmax) = 0 \label{pot_bc1},
\end{align}
and is adapted from \cite{goldreich65a}. The general form of this
potential boundary condition is used for case 2 below. 

\subsubsection{Case 2: tilted field} 
In this more general setup the computational domain is
$z\in[-Z_s, Z_s]$. At the disk surfaces we adopt the `halo' model of
\cite{gammie94}, so that
\begin{align}
  \Delta(\pm Z_s) & = 0, \\
  \dby(\pm Z_s) & = 0,\\
  \dbz(\pm Z_s) \mp \imgi \dbx(\pm Z_s) &= 0,
\end{align}
and the potential boundary condition is 
\begin{align}
  \dphi^\prime(\pm \zmax) \pm k_x\dphi(\pm\zmax) =  - \left. \frac{\Omega^2
    \rho \xi_z}{\rho_0Q}\right|_{\pm\zmax}, \label{pot_bc2}
\end{align}
where $\xi_z=\dvz/\imgi\sigma$ is the vertical Lagrangian
displacement. In practice,  Eq. \ref{pot_bc1} and \ref{pot_bc2} are
very similar because $\rho(\pm\zmax)\ll\rho_0$. 



\subsection{Numerical procedure}
We use a pseudo-spectral method to solve the set of linearized
equations. Let
\begin{align}\label{cheby_expand}
  \bm{U}(z) 
  = \sum_{k=1}^{N_z} \bm{U}_k\psi_k(z/\zmax), 
\end{align}
where 
\begin{align}
  \psi_k  = 
  \begin{cases}
    T_{2(k-1)} & B_y \equiv 0 \text{ (case 1)},\\
    T_{k-1}   & B_y\neq 0 \text{ (case 2)},
  \end{cases}
\end{align}
and  $T_l$ is a Chebyshev polynomial of the first kind of order $l$
\citep{stegun65}. Note that for case 1 the midplane symmetry condition
is taken care of by the choice of basis functions. 

The pseudo-spectral coefficients $\bm{U}_n$  are obtained by demanding
the set of linear equations to be satisfied at $N_z$ collocation
points along the vertical direction, here chosen to be the 
extrema of $T_{l_\mathrm{max}}$ plus end points, where 
$l_\mathrm{max}$ is the highest polynomial order. Our standard
resolution is $N_z=256$ ($N_z=257$) for case 1 (case 2).   

The above procedure discretize the linear equations to a matrix equation,
\begin{align}\label{matrix_eqn}
\bm{M}\bm{w} = \mathbf{0}, 
\end{align}
where $\bm{M}$ is a $4N_z\times 4 N_z$ matrix representing the $L_{ij}$ 
plus boundary conditions, 
and $\bm{w}$ is a vector storing the pseudo-spectral coefficients. 
Starting with an initial guess for $\sigma$, non-trivial solutions to
Eq. \ref{matrix_eqn} are obtained by varying $\sigma$ using Newton-Raphson iteration 
such that $\mathrm{det}\bm{M}=0$ \citep[details can be found in][]{lin12}.


\subsubsection{Non-dimensionalization}\label{non-dim}
We solve the linearized equations in non-dimensional form,
by defining
%We further write 
\begin{align}
  &z=\hat{z}H,\quad k_x =  \hat{k}_x/H,\quad \sigma = \hat{\sigma}\Omega,
  \quad \delta\bm{v} = \csmid 
  \delta\hat{\bm{v}}, \\ 
  &\delta\bm{B} = B_z\delta\hat{\bm{B}},\quad
  \delta\rho = \rho\hat{W}/\hat{c}_s^2,\quad \delta\Phi =
  \csmid^2\delta\hat{\Phi},  
\end{align} 
where $\hat{c}_s=c_s/\csmid$. We also non-dimensionalize 
background quantities, i.e. $\hat{v}_A=v_A/\csmid$,
$\hat{S}=S/\Omega$, $\hat{\kappa}=\kappa/\Omega$,
$\hat{\Omega}_z=\Omega_z/\Omega$ and $\hat{\eta} = \eta/(H^2\Omega)$. 


\subsection{Diagnostics}
We visualize results in terms of dimensionless energy densities. We
define 
\begin{align}
  &E_m \equiv \frac{|\delta \hat{\bm{B}}|^2}{2\beta},\\
  &E_g = 
  \frac{\hat{\rho}}{2\hat{c}_s^2}\left|\real\left(\hat{W}\dd\hat{\Phi}^*\right)\right|,\\  
  &E_k = \frac{1}{2}\hat{\rho}|\delta\hat{\bm{v}}|^2,\\
  &E_t = \frac{\hat{\rho}|\hat{W}|^2}{2\hat{c}_s^2},
\end{align}
as the perturbed magnetic, gravitational, kinetic and thermal
energies, respectively, which are functions of $z$. Although we do not
solve an energy equation, we nevertheless define $E_t$ as a measure of
density perturbations \citep{kojima89}. The total energy
is $E=E_m+E_g+E_k+E_t$. We use $\avg{\cdot}$ to denote an average over
$z$. 

Since we will primarily be concerned with massive disks, we define
\begin{align}
  \tau \equiv \frac{\avg{E_g}}{\avg{E_g} + \avg{E_m}} 
\end{align} 
as a measure of the importance of self-gravity. Thus, modes with $\tau
= 1$ are energetically dominated by self-gravity (GI) and modes with
$\tau\ll1$ are dominated by magnetic perturbations (MRI).   


